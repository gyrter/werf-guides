project: werf-guided-golang
configVersion: 1
---
artifact: buildapp
from: golang:1.15-alpine
git:
- add: /go.mod
  to: /app
  stageDependencies:
    install:
    - "*"
- add: /go.sum
  to: /app
  stageDependencies:
    install:
    - "*"
- add: /cmd
  to: /app/cmd
  stageDependencies:
    setup:
    - "*"
shell:
  beforeInstall:
  - apk add --no-cache --update gcc musl-dev
  install:
  - cd /app/ && go mod download
  setup:
  - cd /app/ && go build ./cmd/demoapp
---
image: basicapp
from: alpine:3.13
import:
- artifact: buildapp
  add: /app/demoapp
  to: /app/demoapp
  after: setup
docker:
  WORKDIR: /app
  CMD: ["/app/demoapp"]
git:
- add: /app.db
  to: /app/app.db
